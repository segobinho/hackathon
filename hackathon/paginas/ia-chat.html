<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Chat</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="ia.css">
</head>
<body>
    <div id="sidebar-container"></div>

    <div class="main-content">
        <div class="page">
            <h1>IA Chat</h1>
            <div class="chat-container">
                <div id="chat-box"></div>
                <div class="input-container">
                    <input type="text" id="user-input" placeholder="Digite sua pergunta aqui..." aria-label="Campo de texto">
                    <button id="send-button" aria-label="Enviar">
                        <i class="bx bx-send"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../javascript/load-sidebar.js"></script>

    <script>
        // Função para enviar a mensagem ao servidor Node.js e receber uma resposta
        async function sendMessageToChatGPT(message) {
            const apiUrl = 'http://localhost:3000/api/chat'; // URL do servidor back-end

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message })
            });

            const result = await response.json();
            return result;
        }

        // Função para adicionar uma mensagem ao chat-box
      function addMessageToChatBox(content, isUser = true) {
    const chatBox = document.getElementById('chat-box');
    const messageElement = document.createElement('div');
    messageElement.classList.add('message');
    messageElement.classList.add(isUser ? 'user-message' : 'bot-message');

    // Verificar se o conteúdo é um objeto
    if (typeof content === 'object') {
        // Aqui você pode ajustar qual propriedade do objeto deseja exibir
        // Por exemplo, se o objeto tiver uma propriedade `message`
        messageElement.textContent = content.message || JSON.stringify(content);
    } else {
        // Se não for um objeto, apenas definir o texto
        messageElement.textContent = content;
    }

    chatBox.appendChild(messageElement);
    chatBox.scrollTop = chatBox.scrollHeight;
}


        document.getElementById('send-button').addEventListener('click', async () => {
            const userInput = document.getElementById('user-input');
            const userMessage = userInput.value;

            if (userMessage.trim() === '') return; // Ignorar mensagens vazias

            // Adicionar mensagem do usuário ao chat-box
            addMessageToChatBox(userMessage, true);

            // Limpar o campo de input
            userInput.value = '';

            // Obter resposta do servidor (que consulta o ChatGPT)
            const botResponse = await sendMessageToChatGPT(userMessage);

            // Adicionar a resposta do bot ao chat-box
            addMessageToChatBox(botResponse, false);
        });

        // Permitir enviar a mensagem ao pressionar "Enter"
        document.getElementById('user-input').addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                document.getElementById('send-button').click();
            }
        });
    </script>
</body>
</html>
